<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>HELINHO DO SINDICATO 36123</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    
    <!-- Scripts atualizados para A-Frame e AR.js -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
</head>

<body style="margin: 0; overflow: hidden;">
    <div style="position: fixed; top: 10px; width: 100%; text-align: center; z-index: 1; color: white; font-family: sans-serif;">
        <p>Olhe ao seu redor para ver o vídeo. Toque no ecrã para ativar o som.</p>
    </div>

    <!-- 
        A cena AR. Removidos os componentes de GPS e câmaras duplicadas 
        para uma experiência mais estável.
    -->
    <a-scene
        vr-mode-ui="enabled: false"
        arjs="sourceType: webcam; videoTexture: true; debugUIEnabled: false;"
        renderer="antialias: true; alpha: true"
    >
        <!-- 
            CORREÇÃO PRINCIPAL: O vídeo é definido APENAS UMA VEZ aqui dentro de <a-assets>.
            Isto evita que múltiplas fontes de áudio sejam carregadas.
        -->
        <a-assets>
            <video 
                id="Video_Asset_0" 
                src="videos/helinho.mp4" 
                preload="auto" 
                autoplay 
                loop 
                crossorigin="anonymous" 
                playsinline 
                webkit-playsinline 
                muted="true">
            </video>
        </a-assets>

        <!-- 
            A câmara representa a sua visão.
            O vídeo é colocado DENTRO da câmara para que se mova com ela.
        -->
        <a-camera>
            <!-- 
                O <a-video> agora usa o 'src' para REFERENCIAR o vídeo dos assets (#helinhoVideo),
                em vez de carregar um novo ficheiro.
            -->
            <a-video
                src="Video_Asset_0"
                width="3"
                height="5"
                position="0 1,5 -4">
            </a-video>
        </a-camera>

    </a-scene>

    <!-- Script para desmutar o vídeo de forma segura na primeira interação do utilizador -->
    <script>
        function unmuteVideoOnFirstInteraction() {
            const video = document.querySelector('Video_Asset_0');
            if (video && video.muted) {
                video.muted = false;
                // Remove o 'listener' após a primeira execução para evitar problemas
                document.body.removeEventListener('click', unmuteVideoOnFirstInteraction);
            }
        }
        document.body.addEventListener('click', unmuteVideoOnFirstInteraction);
    </script>

</body>
</html>
